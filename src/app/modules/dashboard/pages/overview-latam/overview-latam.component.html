<div class="main-container mt-4">
    <div class="main-container mt-5">
        <!-- CARD STATS -->
        <div class="row">
            <div class="col-12">
                <div class="stats-container">
                    <app-card-stat *ngFor="let stat of kpis" [stat]="stat" [loader]="kpisReqStatus <= 1">
                    </app-card-stat>
                </div>
                <p class="text-center text-muted mt-3 mb-0" [hidden]="kpisReqStatus !== 3">
                    {{ 'general.errorData' | translate }}
                </p>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-12">
                <div class="pills-container">
                    <ul class="nav nav-pills nav-fill">
                        <li class="nav-item">
                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab1 === 1}"
                                (click)="getSectorsAndCategories('sectors')">{{ 'general.sector' | translate }}</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab1 === 2}"
                                (click)="getSectorsAndCategories('categories')">{{ 'general.category' | translate }}</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab1 === 3}"
                                (click)="getSectorsAndCategories('funds')">Fondo</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-12 mt-4">
                <div class="card">
                    <div class="card-header">
                        <span class="h4">
                            {{
                            ('overviewLatam.chart1CardTitle1' | translate) +
                            (( selectedTab1 === 1 ? 'overviewLatam.chart1CardTitle2' : selectedTab1 === 2 ?
                            'overviewLatam.chart1CardTitle3' : 'Fondos')
                            | translate) +
                            ('overviewLatam.chart1CardTitle4' | translate)
                            }}
                        </span>
                    </div>
                    <div class="card-body">
                        <app-chart-heat-map [data]="categoriesBySector" name="latam-categories-by-sector'"
                            categoryX="country"
                            [categoryY]="selectedTab1 === 1 ? 'sector' : selectedTab1 === 2 ? 'category' : 'fund'"
                            height="250px" [showGridBorders]="true" [showHeatLegend]="false"
                            [status]="categoriesReqStatus" formatValue="USD" gridBordersColor="#f7f7f7">
                        </app-chart-heat-map>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-12">
                <div class="pills-container">
                    <ul class="nav nav-pills nav-fill">
                        <li class="nav-item">
                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab3 === 1}"
                                (click)="getDataByUsersInvOrAup('users-vs-conversions')">
                                {{ 'general.usersVsSales' | translate }}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab3 === 2}"
                                (click)="getDataByUsersInvOrAup('investment-vs-revenue')">
                                {{ 'general.investmentVsRevenue' | translate }}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab3 === 3}"
                                (click)="getDataByUsersInvOrAup('aup-vs-revenue')">
                                {{ 'general.revenueVsAup' | translate }}
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="col-12 mt-4">
                <div class="card">
                    <div class="card-header">
                        <ng-container [ngSwitch]="selectedTab3">
                            <span *ngSwitchCase="1" class="h4">{{ 'general.usersVsSales' | translate }}</span>
                            <span *ngSwitchCase="2" class="h4">{{ 'general.investmentVsRevenue' | translate }}</span>
                            <span *ngSwitchCase="3" class="h4">{{ 'general.revenueVsAup' | translate }}</span>
                        </ng-container>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12 mb-4">
                                <ul class="nav nav-tabs">
                                    <li class="nav-item" *ngFor="let metric of usersInvOrAupMetrics; let i = index">
                                        <a class="nav-link" [ngClass]="{'active bg-light' : selectedTab4 === i + 1}"
                                            (click)="selectedTab4 = i + 1; selectedTab5 = 1; getDataByUsersInvOrAup()">
                                            <span>{{ metric | titlecase }}</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="col-12 mb-2">
                                <div [ngClass]="{'pills-container' : selectedTab4 !== 3}">
                                    <!-- sector -->
                                    <ul class="nav nav-pills nav-fill"
                                        *ngIf="selectedTab4 === 1 && selectedSectors?.length > 1">
                                        <li class="nav-item mb-2">
                                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab5 === 1}"
                                                (click)="selectedTab5 = 1; getDataByUsersInvOrAup(); clearUsersAndSalesTabs()">
                                                {{ 'others.all' | translate | titlecase }}
                                            </a>
                                        </li>
                                        <li class="nav-item mb-2" *ngFor="let sector of selectedSectors">
                                            <a class="nav-link p-2"
                                                [ngClass]="{'active': sector.id + 2 === selectedTab5}"
                                                (click)="selectedTab5 = sector.id + 2; getDataByUsersInvOrAup(null, sector)">
                                                {{ sector.name }}
                                            </a>
                                        </li>
                                    </ul>

                                    <!-- categoria -->
                                    <ul class="nav nav-pills nav-fill"
                                        *ngIf="selectedTab4 === 2 && selectedCategories?.length > 1">
                                        <li class="nav-item mb-2">
                                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab5 === 1}"
                                                (click)="selectedTab5 = 1; getDataByUsersInvOrAup()">
                                                {{ 'others.all' | translate | titlecase }}
                                            </a>
                                        </li>
                                        <li class="nav-item mb-2" *ngFor="let category of selectedCategories">
                                            <a class="nav-link p-2"
                                                [ngClass]="{'active': category.id + 2 === selectedTab5}"
                                                (click)="selectedTab5 = category.id + 2; getDataByUsersInvOrAup(null, null, category)">
                                                {{ category.name }}
                                            </a>
                                        </li>
                                    </ul>

                                    <!-- fuente -->
                                    <ul class="nav nav-pills nav-fill"
                                        *ngIf="selectedTab4 === 3 && selectedSources?.length > 1">
                                        <li class="nav-item mb-2">
                                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab5 === 1}"
                                                (click)="selectedTab5 = 1; getDataByUsersInvOrAup()">
                                                {{ 'others.all' | translate | titlecase }}
                                            </a>
                                        </li>
                                        <li class="nav-item mb-2" *ngFor="let source of selectedSources">
                                            <a class="nav-link p-2"
                                                [ngClass]="{'active': source.id + 2 === selectedTab5}"
                                                (click)="selectedTab5 = source.id + 2; getDataByUsersInvOrAup(null, null, null, source)">
                                                {{ source.name }}
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <app-chart-multiple-axes [data]="usersInvOrAup"
                            [value1]="selectedTab3 === 1 ? 'transactions' : selectedTab3 === 2 ? 'revenue' : 'revenue'"
                            [value2]="selectedTab3 === 1 ? 'users' : selectedTab3 === 2 ? 'investment': 'aup'"
                            [valueName1]="selectedTab3 === 1 ? 'Conversiones' : selectedTab3 === 2 ? 'Revenue' :'Revenue'"
                            [valueName2]="selectedTab3 === 1 ? 'Usuarios' : selectedTab3 === 2 ? 'InversiÃ³n' : 'AUP'"
                            [valueFormat1]="selectedTab3 > 1 && 'USD'" [valueFormat2]="selectedTab3 > 1 && 'USD'"
                            [status]="usersInvOrAupReqStatus" name="latam-metric-comparison">
                        </app-chart-multiple-axes>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-12">
                <div class="pills-container">
                    <ul class="nav nav-pills nav-fill">
                        <li class="nav-item">
                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab2 === 1}"
                                (click)="getDemographics('traffic'); chartsInitLoad = chartsInitLoad && false">
                                {{ 'general.traffic' | translate }}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab2 === 2}"
                                (click)="getDemographics('sales'); chartsInitLoad = chartsInitLoad && false">
                                {{ 'general.sales' | translate }}
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- devices -->
            <div class="col-12 col-md-6 mt-4">
                <div class="card height-fluid">
                    <div class="card-header">
                        <span class="h4">
                            {{ ((selectedTab2 === 1 ? 'general.traffic' : 'general.sales') | translate) +
                            ('overviewLatam.chart2CardTitle1' | translate) }}
                        </span>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12 col-xl-6 mt-5 mt-xl-0">
                                <div class="chart-legend legend-center mt-0">
                                    <div class="legend-container" *ngIf="demographics?.desktop?.length > 0">
                                        <div class="legend-square on color-1"></div>
                                        <div class="legend-label">Desktop {{ demographics.desktop[1].value }}%
                                        </div>
                                    </div>
                                </div>
                                <app-chart-pictorial [data]="demographics?.desktop" name="latam-devices-desktop"
                                    [uniqueDimensionConf]="{color: '#67B6DC'}" category="name" iconType="monitor"
                                    [status]="demographicsReqStatus[0].reqStatus" height="280px">
                                </app-chart-pictorial>
                            </div>
                            <div class="col-12 col-xl-6 mt-5 mt-xl-0">
                                <div class="chart-legend legend-center mt-0">
                                    <div class="legend-container" *ngIf="demographics?.mobile?.length > 0">
                                        <div class="legend-square on color-2"></div>
                                        <div class="legend-label">Mobile {{ demographics.mobile[1].value }}%
                                        </div>
                                    </div>
                                </div>
                                <app-chart-pictorial [data]="demographics?.mobile" name="latam-devices-mobile"
                                    [uniqueDimensionConf]="{color: '#6794DC'}" category="name" iconType="cellphone"
                                    height="280px" [status]="demographicsReqStatus[0].reqStatus">
                                </app-chart-pictorial>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- gender -->
            <div class="col-12 col-md-6 mt-4">
                <div class="card height-fluid">
                    <div class="card-header">
                        <span class="h4">
                            {{ ((selectedTab2 === 1 ? 'general.traffic' : 'general.sales') | translate) +
                            ('overviewLatam.chart3CardTitle1' | translate) }}
                        </span>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12 col-xl-6 mt-5 mt-xl-0">
                                <div class="chart-legend legend-center mt-0">
                                    <div class="legend-container" *ngIf="demographics?.men?.length > 0">
                                        <div class="legend-square on color-1"></div>
                                        <div class="legend-label">
                                            {{ ('others.men'| translate) + ' '}}
                                            {{ demographics.men[1].value }}%
                                        </div>
                                    </div>
                                </div>
                                <app-chart-pictorial [data]="demographics?.men" name="latam-gender-man"
                                    [uniqueDimensionConf]="{color: '#67B6DC'}" category="name" iconType="man"
                                    [status]="demographicsReqStatus[1].reqStatus" height="280px">
                                </app-chart-pictorial>
                            </div>
                            <div class="col-12 col-xl-6 mt-5 mt-xl-0">
                                <div class="chart-legend legend-center mt-0">
                                    <div class="legend-container" *ngIf="demographics?.women?.length > 0">
                                        <div class="legend-square on color-2"></div>
                                        <div class="legend-label">
                                            {{ ('others.women'| translate) + ' '}}
                                            {{ demographics.women[1].value }}%
                                        </div>
                                    </div>
                                </div>
                                <app-chart-pictorial [data]="demographics?.women" name="latam-gender-woman"
                                    [uniqueDimensionConf]="{color: '#6794DC'}" category="name" iconType="woman"
                                    height="280px" [status]="demographicsReqStatus[1].reqStatus">
                                </app-chart-pictorial>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- age -->
            <div class="col-12 col-md-6 mt-4">
                <div class="card">
                    <div class="card-header">
                        <span class="h4">
                            {{ ((selectedTab2 === 1 ? 'general.traffic' : 'general.sales') | translate) +
                            ('overviewLatam.chart4CardTitle1' | translate) }}
                        </span>
                    </div>
                    <div class="card-body">
                        <app-chart-lollipop [data]="demographics?.age" name="latam-age" category="age"
                            [value]="selectedTab2 === 1 ? 'visits' : 'sales'" height="280px"
                            [status]="demographicsReqStatus[2].reqStatus">
                        </app-chart-lollipop>
                    </div>
                </div>
            </div>

            <!-- age and gender -->
            <div class="col-12 col-md-6 mt-4">
                <div class="card">
                    <div class="card-header">
                        <span class="h4">
                            {{ ((selectedTab2 === 1 ? 'general.traffic' : 'general.sales') | translate) +
                            ('overviewLatam.chart5CardTitle1' | translate) }}
                        </span>
                    </div>
                    <div class="card-body" style="height: 328px">
                        <!-- loader -->
                        <app-chart-loader *ngIf="chartsInitLoad && demographicsReqStatus[3].reqStatus <= 1">
                        </app-chart-loader>

                        <!-- ready -->
                        <app-chart-pyramid *ngIf="demographics?.genderByAge?.length > 0"
                            [data]="demographics?.genderByAge" name="latam-age-and-gender"
                            [status]="demographicsReqStatus[3].reqStatus" height="280px">
                        </app-chart-pyramid>

                        <!-- empty data -->
                        <div *ngIf="demographicsReqStatus[3].reqStatus === 2 && demographics?.genderByAge?.length === 0"
                            class="chart-error-container text-muted">
                            <p class="text-center">
                                {{ 'general.withoutData' | translate }} <br>
                                {{ 'general.withoutData2' | translate }}
                            </p>
                        </div>

                        <!-- error -->
                        <div *ngIf="chartsInitLoad && demographicsReqStatus[3].reqStatus === 3"
                            class="chart-error-container text-muted">
                            <span> {{ 'general.errorData' | translate }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-12" *ngIf="selectedCategories.length > 1">
                <div class="pills-container mb-4">
                    <ul class="nav nav-pills nav-fill">
                        <li class="nav-item" *ngFor="let category of selectedCategories">
                            <a class="nav-link p-2" [ngClass]="{'active': category.id === selectedTab6}"
                                (click)="getTopProducts(category)">
                                {{ category.name }}
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <span class="h4">{{ 'overviewLatam.table1CardTitle1' | translate }}</span>
                        <ng-container *ngIf="selectedCategories?.length > 1">
                            <ng-container [ngSwitch]="selectedTab6">
                                <span *ngSwitchCase="1" class="h4"> - PS</span>
                                <span *ngSwitchCase="2" class="h4"> - HW Print</span>
                                <span *ngSwitchCase="3" class="h4"> - Supplies</span>
                            </ng-container>
                        </ng-container>

                    </div>
                    <div class="card-body">
                        <app-generic-table [displayedColumns]="topProductsColumns" [tableData]="topProducts"
                            [tableDataChange]="topProducts.data" errorData="Error al consultar productos"
                            emptyDataMsg="No se encontraron productos">
                        </app-generic-table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>