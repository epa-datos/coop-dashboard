<div class="main-container mt-4">
    <div class="main-container mt-5">
        <!-- CARD STATS -->
        <div class="row">
            <div class="col-12">
                <div class="stats-container">
                    <app-card-stat *ngFor="let stat of kpis" [stat]="stat" [loader]="kpisReqStatus <= 1">
                    </app-card-stat>
                </div>
                <p class="text-center text-muted mt-3 mb-0" [hidden]="kpisReqStatus !== 3">
                    Error al consultar datos
                </p>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-12">
                <div class="pills-container">
                    <ul class="nav nav-pills nav-fill">
                        <li class="nav-item">
                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab1 === 1}"
                                (click)="getSectorsAndCategories('sectors')">Sector</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab1 === 2}"
                                (click)="getSectorsAndCategories('categories')">Categoría</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-12 mt-4">
                <div class="card">
                    <div class="card-header">
                        <span class="h4">Inversión en {{ selectedTab1 === 1 ? 'Sectores' : 'Categorías' }} por
                            País</span>
                    </div>
                    <div class="card-body">
                        <app-chart-heat-map [data]="categoriesBySector" name="latam-categories-by-sector'"
                            categoryX="country" [categoryY]="selectedTab1 === 1 ? 'sector' : 'category'" height="250px"
                            [showGridBorders]="true" [showHeatLegend]="false" [status]="categoriesReqStatus"
                            gridBordersColor="#f7f7f7">
                        </app-chart-heat-map>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-12">
                <div class="pills-container">
                    <ul class="nav nav-pills nav-fill">
                        <li class="nav-item">
                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab2 === 1}"
                                (click)="getDataByTrafficAndSales('traffic'); chartsInitLoad = chartsInitLoad && false;">Tráfico</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab2 === 2}"
                                (click)="getDataByTrafficAndSales('sales'); chartsInitLoad = chartsInitLoad && false;">Ventas</a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- devices -->
            <div class="col-12 col-md-6 mt-4">
                <div class="card">
                    <div class="card-header">
                        <span class="h4">{{selectedTab2 === 1 ? 'Tráfico' : 'Ventas'}} por dispositivos</span>
                    </div>
                    <div class="card-body">
                        <app-chart-pictorial [data]="trafficAndSales['device']" name="latam-devices" category="name"
                            iconType="monitor" [status]="trafficSalesReqStatus[0].reqStatus" height="280px">
                        </app-chart-pictorial>
                    </div>
                </div>
            </div>

            <!-- gender -->
            <div class="col-12 col-md-6 mt-4">
                <div class="card">
                    <div class="card-header">
                        <span class="h4">{{selectedTab2 === 1 ? 'Tráfico' : 'Ventas'}} por Género</span>
                    </div>
                    <div class="card-body">
                        <app-chart-pictorial [data]="trafficAndSales['gender']" name="latam-gender" category="name"
                            iconType="man" [status]="trafficSalesReqStatus[1].reqStatus" height="280px">
                        </app-chart-pictorial>
                    </div>
                </div>
            </div>

            <!-- age -->
            <div class="col-12 col-md-6 mt-4">
                <div class="card">
                    <div class="card-header">
                        <span class="h4">{{selectedTab2 === 1 ? 'Tráfico' : 'Ventas'}} por Edad</span>
                    </div>
                    <div class="card-body">
                        <app-chart-lollipop [data]="trafficAndSales['age']" name="latam-age" category="age"
                            [value]="selectedTab2 === 1 ? 'visits' : 'sales'" height="280px"
                            [status]="trafficSalesReqStatus[2].reqStatus">
                        </app-chart-lollipop>
                    </div>
                </div>
            </div>

            <!-- age and gender -->
            <div class="col-12 col-md-6 mt-4">
                <div class="card">
                    <div class="card-header">
                        <span class="h4">{{selectedTab2 === 1 ? 'Tráfico' : 'Ventas'}} por Género y Edad</span>
                    </div>
                    <div class="card-body" style="height: 328px">
                        <!-- loader -->
                        <app-chart-loader *ngIf="chartsInitLoad && trafficSalesReqStatus[3].reqStatus <= 1">
                        </app-chart-loader>

                        <!-- ready -->
                        <app-chart-pyramid *ngIf="trafficAndSales['genderByAge']?.length > 0"
                            [data]="trafficAndSales['genderByAge']" name="latam-age-and-gender"
                            [status]="trafficSalesReqStatus[3].reqStatus" height="280px">
                        </app-chart-pyramid>

                        <!-- empty data -->
                        <div *ngIf="trafficSalesReqStatus[3].reqStatus === 2 && trafficAndSales['genderByAge']?.length === 0"
                            class="chart-error-container text-muted">
                            <p class="text-center">
                                Sin datos disponibles <br>
                                Muestra insuficiente
                            </p>
                        </div>

                        <!-- error -->
                        <div *ngIf="chartsInitLoad && trafficSalesReqStatus[3].reqStatus === 3"
                            class="chart-error-container text-muted">
                            <span>Error al consultar datos</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-12">
                <div class="pills-container">
                    <ul class="nav nav-pills nav-fill">
                        <li class="nav-item">
                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab3 === 1}"
                                (click)="getDataByUsersAndSales('users')">Usuarios</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab3 === 2}"
                                (click)="getDataByUsersAndSales('sales')">Ventas</a>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="col-12 mt-4">
                <div class="card">
                    <div class="card-header">
                        <span class="h4">{{ selectedTab3 === 1 ? 'Usuarios' : 'Ventas'}} por </span>
                        <ng-container [ngSwitch]="selectedTab4">
                            <span *ngSwitchCase="1" class="h4">Sector</span>
                            <span *ngSwitchCase="2" class="h4">Categoría</span>
                            <span *ngSwitchCase="3" class="h4">Medio</span>
                        </ng-container>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12 mb-4">
                                <ul class="nav nav-tabs">
                                    <li class="nav-item" *ngFor="let metric of usersAndSalesMetrics; let i = index">
                                        <a class="nav-link" [ngClass]="{'active bg-light' : selectedTab4 === i + 1}"
                                            (click)="selectedTab4 = i + 1; selectedTab5 = 1; getDataByUsersAndSales(selectedTab3 === 1 ? 'users' : 'sales')">
                                            <span>{{ metric | titlecase }}</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="col-12 mb-2">
                                <div [ngClass]="{'pills-container' : selectedTab4 !== 3}">
                                    <!-- sector -->
                                    <ul class="nav nav-pills nav-fill"
                                        *ngIf="selectedTab4 === 1 && selectedSectors?.length > 1">
                                        <li class="nav-item mb-2">
                                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab5 === 1}"
                                                (click)="selectedTab5 = 1; getDataByUsersAndSales(selectedTab3 === 1 ? 'users' : 'sales'); clearUsersAndSalesTabs()">Todo</a>
                                        </li>
                                        <li class="nav-item mb-2" *ngFor="let sector of selectedSectors">
                                            <a class="nav-link p-2"
                                                [ngClass]="{'active': sector.id + 2 === selectedTab5}"
                                                (click)="selectedTab5 = sector.id + 2; getDataByUsersAndSales(selectedTab3 === 1 ? 'users' : 'sales', sector)">
                                                {{ sector.name}}
                                            </a>
                                        </li>
                                    </ul>

                                    <!-- categoria -->
                                    <ul class="nav nav-pills nav-fill"
                                        *ngIf="selectedTab4 === 2 && selectedCategories?.length > 1">
                                        <li class="nav-item mb-2">
                                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab5 === 1}"
                                                (click)="selectedTab5 = 1; getDataByUsersAndSales(selectedTab3 === 1 ? 'users' : 'sales')">Todo</a>
                                        </li>
                                        <li class="nav-item mb-2" *ngFor="let category of selectedCategories">
                                            <a class="nav-link p-2"
                                                [ngClass]="{'active': category.id + 2 === selectedTab5}"
                                                (click)="selectedTab5 = category.id + 2; getDataByUsersAndSales(selectedTab3 === 1 ? 'users' : 'sales', null, category)">
                                                {{ category.name}}
                                            </a>
                                        </li>
                                    </ul>

                                    <!-- medio -->
                                    <ul class="nav nav-pills nav-fill"
                                        *ngIf="selectedTab4 === 3 && selectedSources?.length > 1">
                                        <li class="nav-item mb-2">
                                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab5 === 1}"
                                                (click)="selectedTab5 = 1; getDataByUsersAndSales(selectedTab3 === 1 ? 'users' : 'sales')">Todo</a>
                                        </li>
                                        <li class="nav-item mb-2" *ngFor="let source of selectedSources">
                                            <a class="nav-link p-2"
                                                [ngClass]="{'active': source.id + 2 === selectedTab5}"
                                                (click)="selectedTab5 = source.id + 2; getDataByUsersAndSales(selectedTab3 === 1 ? 'users' : 'sales', null, null, source)">
                                                {{ source.name}}
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- <div class="period-popover" ngbDropdown>
                            <a ngbDropdownToggle>
                                <i class="fas fa-question-circle"></i>
                            </a>
                            <div class="content" ngbDropdownMenu>
                                <li class="period text-sm" *ngFor="let serie of usersAndSalesByMetric; let i = index">
                                    <div class="line mr-2"
                                        [ngClass]="{'first': i === 0, 'second': i === 1, 'third': i === 2}">
                                    </div>
                                    <strong class="mr-2">{{ serie.name }}</strong>
                                    <span>{{ serie.period }}</span>
                                </li>
                            </div>
                        </div> -->

                        <app-chart-line-series [series]="usersAndSalesByMetric"
                            [valueName]="selectedTab3 === 1 ? 'Usuarios' : 'Ventas'" name="latam-sales-users-by-sector"
                            [status]="usersAndSalesReqStatus">
                        </app-chart-line-series>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <span class="h4">Inversión vs Revenue</span>
                    </div>
                    <div class="card-body">
                        <app-chart-multiple-axes [data]="investmentVsRevenue" valueName1="Inversión"
                            valueName2="Revenue" value1="investment" value2="revenue" name="latam-investment-vs-revenue"
                            [status]="invVsRevenueReqStatus">
                        </app-chart-multiple-axes>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-12" *ngIf="selectedCategories.length > 1">
                <div class="pills-container mb-4">
                    <ul class="nav nav-pills nav-fill">
                        <li class="nav-item" *ngFor="let category of selectedCategories">
                            <a class="nav-link p-2" [ngClass]="{'active': category.id === selectedTab6}"
                                (click)="getTopProducts(category)">
                                {{ category.name}}
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <span class="h4">Top Productos </span>
                        <ng-container *ngIf="selectedCategories?.length > 1">
                            <ng-container [ngSwitch]="selectedTab6">
                                <span *ngSwitchCase="1" class="h4">- PS</span>
                                <span *ngSwitchCase="2" class="h4">- HW Print</span>
                                <span *ngSwitchCase="3" class="h4">- Supplies</span>
                            </ng-container>
                        </ng-container>

                    </div>
                    <div class="card-body">
                        <div class="adaptable-container" [ngClass]="{'auto': topProductsReqStatus === 3}">
                            <div class="loading-shade" [hidden]="topProductsReqStatus > 1">
                                <mat-spinner></mat-spinner>
                            </div>

                            <table mat-table [dataSource]="topProductsSource">
                                <!-- category column -->
                                <ng-container matColumnDef="rank">
                                    <th mat-header-cell *matHeaderCellDef [style.width.px]="150">Rank</th>
                                    <td mat-cell *matCellDef="let element">
                                        {{element.rank}} </td>
                                </ng-container>

                                <!-- product column -->
                                <ng-container matColumnDef="product">
                                    <th mat-header-cell *matHeaderCellDef>Producto </th>
                                    <td mat-cell *matCellDef="let element">
                                        <!-- <span #tooltip="matTooltip" md-raised-button [matTooltip]="element.product"
                                            matTooltipPosition="right" matTooltipClass="custom-tooltip">
                                            {{element.product}}
                                        </span> -->
                                        <span>{{element.product}}</span>
                                    </td>
                                </ng-container>

                                <!-- amount -->
                                <ng-container matColumnDef="amount">
                                    <th mat-header-cell *matHeaderCellDef [style.width.px]="150">Cantidad</th>
                                    <td mat-cell *matCellDef="let element">
                                        {{element.amount}} </td>
                                </ng-container>

                                <!-- ERROR COLUMN -->
                                <ng-container matColumnDef="disclaimer">
                                    <td mat-footer-cell *matFooterCellDef colspan="3">
                                        <div class="text-danger text-center" [hidden]="topProductsReqStatus !== 3">
                                            Ocurrió un error al consultar los productos
                                        </div>
                                    </td>
                                </ng-container>

                                <tr mat-header-row *matHeaderRowDef="topProductsColumns"></tr>
                                <tr mat-row *matRowDef="let row; columns: topProductsColumns;"></tr>
                                <tr mat-footer-row *matFooterRowDef="['disclaimer']" class="example-second-footer-row"
                                    [hidden]="topProductsReqStatus !== 3"></tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>