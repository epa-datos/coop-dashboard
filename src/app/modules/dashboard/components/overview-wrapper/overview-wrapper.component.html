<div class="main-container mt-5">
    <!-- CARD STATS -->
    <div class="row">
        <div class="col-12">
            <div class="stats-container">
                <app-card-stat *ngFor="let stat of kpis" [stat]="stat" [loader]="kpisReqStatus <= 1"></app-card-stat>
            </div>
            <p class="text-center text-muted mt-3 mb-0" [hidden]="kpisReqStatus !== 3">
                Error al consultar datos
            </p>
        </div>
    </div>

    <div class="row mt-5">
        <div class="col-12" *ngIf="selectedType === 'country'">
            <div class="pills-container">
                <ul class="nav nav-pills nav-fill" *ngIf="selectedSectors?.length > 1">
                    <li class="nav-item mb-2" *ngFor="let sector of selectedSectors; let i = index">
                        <a class="nav-link p-2" [ngClass]="{'active': sector.id === selectedTab1}"
                            (click)="getCategoriesBySector(sector)">
                            {{ sector.name }}
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-12 mt-4">
            <div class="card">
                <div class="card-header">
                    <ng-container *ngIf="selectedType === 'country'" [ngSwitch]="selectedTab1">
                        <span *ngSwitchCase="1" class="h4">Categorías por Retailer - Search</span>
                        <span *ngSwitchCase="2" class="h4">Categorías por Retailer - Marketing</span>
                        <span *ngSwitchCase="3" class="h4">Categorías por Retailer - Ventas</span>
                    </ng-container>

                    <span *ngIf="selectedType === 'retailer'" class="h4">Categorías por Sector</span>
                </div>
                <div class="card-body">
                    <div class="chart-legend mt-0 mb-2">
                        <div class="legend-container">
                            <div class="legend-square on"></div>
                            <div class="legend-label">Activas</div>
                        </div>
                        <div class="legend-container ml-3">
                            <div class="legend-square off"></div>
                            <div class="legend-label">Inactivas</div>
                        </div>
                    </div>
                    <app-chart-heat-map [data]="categoriesBySector" [name]="selectedType + 'categories-by-sector'"
                        [categoryX]="selectedType === 'country' ? 'retailer' : 'sector'" categoryY="category"
                        height="250px" [showTooltipValue]="false" [showGridBorders]="true" [showHeatLegend]="false"
                        [status]="categoriesReqStatus" [minValue]="0" [maxValue]="1" initialColor="#e9e9e9">
                    </app-chart-heat-map>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-5" *ngIf="showTrafficAndSalesSection">
        <div class="col-12">
            <div class="pills-container">
                <ul class="nav nav-pills nav-fill">
                    <li class="nav-item">
                        <a class="nav-link p-2" [ngClass]="{'active': selectedTab2 === 1}"
                            (click)="getDataByTrafficAndSales('traffic'); chartsInitLoad = chartsInitLoad && false;">Tráfico</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link p-2" [ngClass]="{'active': selectedTab2 === 2}"
                            (click)="getDataByTrafficAndSales('sales'); chartsInitLoad = chartsInitLoad && false;">Ventas</a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- devices -->
        <div class="col-12 col-md-6 mt-4">
            <div class="card">
                <div class="card-header">
                    <span class="h4">{{selectedTab2 === 1 ? 'Tráfico' : 'Ventas'}} por dispositivos</span>
                </div>
                <div class="card-body">
                    <app-chart-pictorial [data]="trafficAndSales['device']" [name]="selectedType + 'devices'"
                        category="name" iconType="monitor" [status]="trafficSalesReqStatus[0].reqStatus" height="280px">
                    </app-chart-pictorial>
                </div>
            </div>
        </div>

        <!-- gender -->
        <div class="col-12 col-md-6 mt-4">
            <div class="card">
                <div class="card-header">
                    <span class="h4">{{selectedTab2 === 1 ? 'Tráfico' : 'Ventas'}} por Género</span>
                </div>
                <div class="card-body">
                    <app-chart-pictorial [data]="trafficAndSales['gender']" [name]="selectedType + 'gender'"
                        category="name" iconType="man" [status]="trafficSalesReqStatus[1].reqStatus" height="280px">
                    </app-chart-pictorial>
                </div>
            </div>
        </div>

        <!-- age -->
        <div class="col-12 col-md-6 mt-4">
            <div class="card">
                <div class="card-header">
                    <span class="h4">{{selectedTab2 === 1 ? 'Tráfico' : 'Ventas'}} por Edad</span>
                </div>
                <div class="card-body">
                    <app-chart-lollipop [data]="trafficAndSales['age']" [name]="selectedType + 'age'" category="age"
                        [value]="selectedTab2 === 1 ? 'visits' : 'sales'" height="280px"
                        [status]="trafficSalesReqStatus[2].reqStatus">
                    </app-chart-lollipop>
                </div>
            </div>
        </div>

        <!-- age and gender -->
        <div class="col-12 col-md-6 mt-4">
            <div class="card">
                <div class="card-header">
                    <span class="h4">{{selectedTab2 === 1 ? 'Tráfico' : 'Ventas'}} por Género y Edad</span>
                </div>
                <div class="card-body" style="height: 328px">
                    <!-- loader -->
                    <app-chart-loader *ngIf="chartsInitLoad && trafficSalesReqStatus[3].reqStatus <= 1">
                    </app-chart-loader>

                    <!-- ready -->
                    <app-chart-pyramid *ngIf="trafficAndSales['genderByAge']?.length > 0"
                        [data]="trafficAndSales['genderByAge']" [name]="selectedType + 'age-and-gender'"
                        [status]="trafficSalesReqStatus[3].reqStatus" height="280px">
                    </app-chart-pyramid>

                    <!-- empty data -->
                    <div *ngIf="trafficSalesReqStatus[3].reqStatus === 2 && trafficAndSales['genderByAge']?.length === 0"
                        class="chart-error-container text-muted">
                        <p class="text-center">
                            Sin datos disponibles <br>
                            Muestra insuficiente
                        </p>
                    </div>

                    <!-- error -->
                    <div *ngIf="chartsInitLoad && trafficSalesReqStatus[3].reqStatus === 3"
                        class="chart-error-container text-muted">
                        <span>Error al consultar datos</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-5">
        <div class="col-12">
            <div class="pills-container">
                <ul class="nav nav-pills nav-fill">
                    <li class="nav-item">
                        <a class="nav-link p-2" [ngClass]="{'active': selectedTab3 === 1}"
                            (click)="getDataByUsersAndSales('users')">Usuarios</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link p-2" [ngClass]="{'active': selectedTab3 === 2}"
                            (click)="getDataByUsersAndSales('sales')">Ventas</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-12 mt-4">
            <div class="card">
                <div class="card-header">
                    <span class="h4" [hidden]="selectedTab3 === 2">Usuarios por Sector</span>
                    <span class="h4" [hidden]="selectedTab3 === 1">Ventas por Sector</span>
                </div>
                <div class="card-body">
                    <app-chart-line-series [series]="usersAndSalesBySector"
                        [valueName]="selectedTab3 === 1 ? 'Usuarios' : 'Ventas'"
                        [name]="selectedType + 'sales-users-by-sector'" [status]="usersAndSalesReqStatus">
                    </app-chart-line-series>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <span class="h4">Inversión vs Revenue</span>
                </div>
                <div class="card-body">
                    <app-chart-multiple-axes [data]="investmentVsRevenue" valueName1="Inversión" valueName2="Revenue"
                        value1="investment" value2="revenue" [name]="selectedType + 'investment-vs-revenue'"
                        [status]="invVsRevenueReqStatus">
                    </app-chart-multiple-axes>
                </div>
            </div>
        </div>
    </div>
</div>