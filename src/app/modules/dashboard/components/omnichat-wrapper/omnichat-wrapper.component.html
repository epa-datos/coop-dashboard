<!-- TARJETAS DE MÉTRICAS -->
<div class="row mt-5">
    <div class="col-12">
        <div class="stats-container">
            <app-card-stat *ngFor="let stat of kpis" [stat]="stat" [loader]="kpisReqStatus <= 1" [smallHeader]="true"
                height="100px">
            </app-card-stat>
        </div>
        <p class="text-center text-muted mt-3 mb-0" [hidden]="kpisReqStatus !== 3">
            {{ 'general.errorData' | translate }}
        </p>
    </div>
</div>

<!-- USUARIOS AND REVENUE -->
<div class="row mt-5">
    <div class="col-12">
        <div class="pills-container">
            <ul class="nav nav-pills nav-fill">
                <li class="nav-item">
                    <a class="nav-link p-2" [ngClass]="{'active': selectedTab1 === 1}"
                        (click)="getUsersOrRevenue('conversions-vs-users');">
                        {{ 'general.usersVsSales' | translate }}
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link p-2" [ngClass]="{'active': selectedTab1 === 2}"
                        (click)="getUsersOrRevenue('aup-vs-revenue')">
                        {{ 'general.revenueVsAup' | translate }}
                    </a>
                </li>
                <li class="nav-item" [hidden]="true">
                    <a class="nav-link p-2" [ngClass]="{'active': selectedTab1 === 3}"
                        (click)="selectedTab1 = 3; !usersAndConv && getUsersOrRevenuePromise('conversions-vs-users')">
                        {{ 'general.conversionRate' |translate }}
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <div class="col-12 mt-4">
        <div class="card">
            <div class="card-header">
                <ng-container [ngSwitch]="selectedTab1">
                    <span class="h4" *ngSwitchCase="1">{{ 'general.usersVsSales' | translate }}</span>
                    <span class="h4" *ngSwitchCase="2">{{ 'general.revenueVsAup' |translate }}</span>
                    <span class="h4" *ngSwitchCase="3">{{ 'general.conversionRate' |translate }}</span>
                </ng-container>
            </div>
            <div class="card-body">
                <app-chart-multiple-axes *ngIf="selectedTab1 !== 3" [data]="usersOrRevenue"
                    [value1]="selectedTab1 === 1 ? 'transactions' : 'revenue'"
                    [value2]="selectedTab1 === 1 ? 'users' : 'aup'"
                    [valueName1]="selectedTab1 === 1 ? ('general.conversions' | translate) : 'Revenue'"
                    [valueName2]="selectedTab1 === 1 ? ('general.users' | translate ): 'AUP'"
                    [valueFormat1]="selectedTab1 === 2 && 'USD'" [valueFormat2]="selectedTab1 === 2 && 'USD'"
                    name="omnichat-traffic-vs-conversions" [status]="usersOrRevenueReqStatus">
                </app-chart-multiple-axes>

                <app-chart-line *ngIf="selectedTab1 === 3" [data]="cr" value="cr" valueFormat="%"
                    yTitle="Conversion Rate %" name="omnichat-cr" [status]="usersOrRevenueReqStatus">
                </app-chart-line>
            </div>
        </div>
    </div>
</div>
<hr>

<!-- CHARTS POR PAÍS, RETAILER & CATEGORIA -->
<div class="row mt-5">
    <div class="col-12">
        <div class="mb-3">
            <span class="h3" *ngIf="!levelPage.retailer">{{ 'omnichat.section1Title1Prov' | translate }}</span>
            <span class="h3" *ngIf="levelPage.retailer">{{ 'omnichat.section1Title2Prov' | translate }}</span>
        </div>
    </div>

    <div class="col-12" *ngIf="!levelPage.retailer">
        <div class="pills-container">
            <ul class="nav nav-pills nav-fill">
                <li class="nav-item">
                    <a class="nav-link p-2" [ngClass]="{'active': selectedTab2 === 1}"
                        (click)="getDataByLevel('chats')">Chats</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link p-2" [ngClass]="{'active': selectedTab2 === 2}"
                        (click)="getDataByLevel('traffic')">{{ 'general.users' | translate }}</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link p-2" [ngClass]="{'active': selectedTab2 === 3}"
                        (click)="getDataByLevel('sales')">{{ 'general.conversions' | translate }}</a>
                </li>
                <li class="nav-item" [hidden]="true">
                    <a class="nav-link p-2" [ngClass]="{'active': selectedTab2 === 4}"
                        (click)="getDataByLevel('conversion-rate')">{{ 'general.conversionRate' | translate }}</a>
                </li>
            </ul>
        </div>
    </div>

    <!-- countries -->
    <div *ngIf="levelPage.latam" class="col-12 col-lg-4 mt-4" [ngClass]="{'col-lg-6': selectedTab2 < 3}">
        <div class="card height-fluid">
            <div class="card-header h4">
                <ng-container [ngSwitch]="selectedTab2">
                    <span *ngSwitchCase="1">Chats</span>
                    <span *ngSwitchCase="2">{{ 'general.users' | translate }}</span>
                    <span *ngSwitchCase="3">{{ 'general.conversions' | translate }}</span>
                    <span *ngSwitchCase="4">{{ 'general.conversionRate' | translate }}</span>
                </ng-container>
                <span>{{ 'charts.byCountry' | translate }}</span>
            </div>
            <div class="card-body">
                <app-chart-bar-horizontal [data]="dataByLevel.countries" name="omnichat-chats-by-country"
                    category="country" [value]="selectedTab2 <= 2 ? 'chats' : 'value'"
                    [valueFormat]="selectedTab2 === 4 && '%'" [singleColorBars]="true"
                    [status]="dataByLevelReqStatus[0].reqStatus">
                </app-chart-bar-horizontal>
            </div>
        </div>
    </div>

    <!-- retailers -->
    <div *ngIf="levelPage.latam || levelPage.country" class="col-12 col-lg-4 mt-4"
        [ngClass]="{'col-lg-6' : selectedTab2 < 3 || (levelPage.country && selectedTab2 > 2), 'col-lg-12' : levelPage.country && selectedTab2 <= 2}">
        <div class="card height-fluid superimposed">
            <div class="card-header h4">
                <ng-container [ngSwitch]="selectedTab2">
                    <span *ngSwitchCase="1">Chats</span>
                    <span *ngSwitchCase="2">{{ 'general.users' | translate }}</span>
                    <span *ngSwitchCase="3">{{ 'general.conversions' | translate }}</span>
                    <span *ngSwitchCase="4">{{ 'general.conversionRate' | translate }}</span>
                </ng-container>
                <span>{{ 'charts.byRetailer' | translate }}</span>
            </div>
            <div class="card-body" [ngClass]="{'overfow-container': dataByLevel?.retailers?.length > 10}">
                <div class="superimposed">
                    <app-chart-bar-horizontal [data]="dataByLevel.retailers" name="omnichat-chats-by-retailer"
                        category="retailer" [value]="selectedTab2 <= 2 ? 'chats' : 'value'"
                        [valueFormat]="selectedTab2 === 4 && '%'" [truncateLabels]="true" [singleColorBars]="true"
                        [height]="dataByLevel?.retailers?.length > 10 ? '600px' : '350px'"
                        [status]="dataByLevelReqStatus[1].reqStatus">
                    </app-chart-bar-horizontal>
                </div>

            </div>
        </div>
    </div>

    <!-- categories -->
    <div *ngIf="selectedTab2 > 2 || levelPage.retailer" class="col-12 col-lg-4 mt-4"
        [ngClass]="{ 'col-lg-6' : !levelPage.latam, 'col-lg-12': levelPage.retailer}">
        <div class="card height-fluid">
            <div class="card-header h4">
                <ng-container *ngIf="!levelPage.retailer">
                    <ng-container [ngSwitch]="selectedTab2">
                        <span *ngSwitchCase="3">
                            {{ ('general.conversions' | translate) + ('charts.byCategory' | translate) }}
                        </span>
                        <span *ngSwitchCase="4">
                            {{ ('general.conversionRate' | translate) + ('charts.byCategory' | translate) }}
                        </span>
                    </ng-container>
                </ng-container>

                <span *ngIf="levelPage.retailer">
                    {{ ('general.conversions' | translate) + ('charts.byCategory' | translate) }}
                </span>
            </div>
            <div class="card-body">
                <app-chart-bar-horizontal [data]="dataByLevel.category1" name="omnichat-chats-by-category-1"
                    category="name" [valueFormat]="selectedTab2 === 4 && '%'" [truncateLabels]="true"
                    [singleColorBars]="true" [status]="dataByLevelReqStatus[2].reqStatus">
                </app-chart-bar-horizontal>
            </div>
        </div>
    </div>
    <div *ngIf="levelPage.retailer" class="col-12 col-lg-6 mt-4" [hidden]="true">
        <div class="card height-fluid">
            <div class="card-header">
                <span class="h4">
                    {{ ('general.conversionRate' | translate) + ('charts.byCategory' | translate) }}
                </span>
            </div>
            <div class="card-body">
                <app-chart-bar-horizontal [data]="dataByLevel.category2" name="omnichat-chats-by-category-2"
                    category="name" valueFormat="%" [truncateLabels]="true" [singleColorBars]="true"
                    [status]="dataByLevelReqStatus[3].reqStatus">
                </app-chart-bar-horizontal>
            </div>
        </div>
    </div>
</div>
<hr>

<!-- CONVERSIONES - TASAS DE CONVERSION -->
<div class="row mt-5">
    <div class="col-12">
        <span class="h3">{{ 'omnichat.section2Title1' | translate }}</span>
    </div>
    <div class="col-12 mt-3">
        <div class="pills-container" *ngIf="selectedCategories?.length > 1">
            <ul class="nav nav-pills nav-fill">
                <li class="nav-item" *ngFor="let category of selectedCategories">
                    <a class="nav-link p-2" [ngClass]="{'active': category.id === selectedTab3}"
                        (click)="getSalesByProduct(category); getUsersSalesAndCR(category)">
                        {{ category.name }}
                    </a>
                </li>
            </ul>
        </div>
        <div class="row">
            <div class="col-12 mt-4">
                <div class="card height-fluid superimposed">
                    <div class="card-header">
                        <span class="h4">{{ 'omnichat.chart6CardTitle1' | translate }}</span>
                    </div>
                    <div class="card-body">
                        <app-chart-bar-horizontal [data]="salesByProduct" name="omnichat-transactions-by-product"
                            category="product" value="quantity" [singleColorBars]="true"
                            [status]="salesByProductReqStatus">
                        </app-chart-bar-horizontal>
                        <small class="text-muted mt-2 d-block d-sm-none">
                            {{ 'charts.mobileSuggestion' | translate }}
                            <strong>{{ 'charts.mobileSuggestion2' | translate }}</strong>
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-12 mt-4">
                <div class="card height-fluid">
                    <div class="card-header">
                        <span class="h4">{{ 'omnichat.chart7CardTitle1Prov' | translate }}</span>
                    </div>
                    <div class="card-body">
                        <div class="chart-legend mt-0 mb-2">
                            <div class="legend-container legend-right">
                                <div class="legend-square color-1"></div>
                                <div class="legend-label">{{ 'general.users' | translate }}</div>
                            </div>
                            <div class="legend-container ml-3">
                                <div class="legend-square color-2"></div>
                                <div class="legend-label">{{ 'general.conversions' | translate }}</div>
                            </div>
                            <div class="legend-container ml-3" [hidden]="true">
                                <div class="legend-square color-3"></div>
                                <div class="legend-label">{{ 'general.conversionRate' | translate }}</div>
                            </div>
                        </div>
                        <app-chart-bar-group [data]="usersSalesAndCR" name="omnichat-users-transactions-rate"
                            height="325px" valueBar1="users" valueBar2="transactions"
                            [valueNameBar1]="'general.users' | translate"
                            [valueNameBar2]="'general.conversions' | translate" valueFormatLine1="%"
                            [status]="usersSalesAndCRReqStatus">
                            <!-- valueLine1="conversion_rate" -->
                        </app-chart-bar-group>
                    </div>
                </div>
            </div>

            <!-- PERFOMANCE BY CATEGORY -->
            <div class="col-12 mt-4">
                <app-generic-table [displayedColumns]="performanceByCategoryColumns" [tableData]="performanceByCategory"
                    [tableDataChange]="performanceByCategory.data">
                </app-generic-table>
            </div>
        </div>
    </div>
</div>
<hr>

<!-- TRAFFICO Y CONVERSIONES (7 GRAFICOS) -->
<div class="row mt-5">
    <div class="col-12">
        <span class="h3">{{ 'general.audience' | translate }}</span>
    </div>
    <div class="col-12 mt-3">
        <div class="row">
            <div class="col-12">
                <div class="pills-container">
                    <ul class="nav nav-pills nav-fill">
                        <li class="nav-item">
                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab4 === 1}"
                                (click)="getAudienceByMetric('traffic'); chartsInitLoad = chartsInitLoad && false">
                                {{ 'general.traffic' | translate }}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link p-2" [ngClass]="{'active': selectedTab4 === 2}"
                                (click)="getAudienceByMetric('sales'); chartsInitLoad = chartsInitLoad && false">
                                {{ 'general.conversions' | translate }}
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- devices -->
            <div class="col-12 col-md-6 mt-4">
                <div class="card height-fluid">
                    <div class="card-header">
                        <span class="h4">
                            {{ (selectedTab4 === 1 ? 'general.traffic' : 'general.conversions' ) | translate }}
                            {{ 'charts.byDevice' | translate }}
                        </span>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12 col-xl-6 mt-5 mt-xl-0">
                                <div class="chart-legend legend-center mt-0">
                                    <div class="legend-container" *ngIf="audience?.desktop?.length > 0">
                                        <div class="legend-square on color-4"></div>
                                        <div class="legend-label">Desktop {{ audience.desktop[1].value }}%</div>
                                    </div>
                                </div>
                                <app-chart-pictorial [data]="audience?.desktop" name="omnichat-devices-desktop"
                                    [uniqueDimensionConf]="{color: '#67B6DC'}" category="name" iconType="monitor"
                                    [status]="audienceReqStatus[0].reqStatus" height="280px">
                                </app-chart-pictorial>
                            </div>
                            <div class="col-12 col-xl-6 mt-5 mt-xl-0">
                                <div class="chart-legend legend-center mt-0">
                                    <div class="legend-container" *ngIf="audience?.mobile?.length > 0">
                                        <div class="legend-square on color-5"></div>
                                        <div class="legend-label">Mobile {{ audience.mobile[1].value }}%</div>
                                    </div>
                                </div>
                                <app-chart-pictorial [data]="audience?.mobile" name="omnichat-devices-mobile"
                                    [uniqueDimensionConf]="{color: '#6794DC'}" category="name" iconType="cellphone"
                                    height="280px" [status]="audienceReqStatus[0].reqStatus">
                                </app-chart-pictorial>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- gender -->
            <div class="col-12 col-md-6 mt-4">
                <div class="card height-fluid">
                    <div class="card-header">
                        <span class="h4">
                            {{ (selectedTab4 === 1 ? 'general.traffic' : 'general.conversions' ) | translate }}
                            {{ 'charts.byGender' | translate }}
                        </span>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12 col-xl-6 mt-5 mt-xl-0">
                                <div class="chart-legend legend-center mt-0">
                                    <div class="legend-container" *ngIf="audience?.men?.length > 0">
                                        <div class="legend-square on color-4"></div>
                                        <div class="legend-label">
                                            {{ 'others.men' | translate }} {{ audience.men[1].value }}%
                                        </div>
                                    </div>
                                </div>
                                <app-chart-pictorial [data]="audience?.men" name="omnichat-gender-man"
                                    [uniqueDimensionConf]="{color: '#67B6DC'}" category="name" iconType="man"
                                    height="280px" [status]="audienceReqStatus[1].reqStatus">
                                </app-chart-pictorial>
                            </div>

                            <div class="col-12 col-xl-6 mt-5 mt-xl-0">
                                <div class="chart-legend legend-center mt-0">
                                    <div class="legend-container" *ngIf="audience?.women?.length > 0">
                                        <div class="legend-square on color-5"></div>
                                        <div class="legend-label">
                                            {{ 'others.women' | translate }} {{ audience.women[1].value }}%
                                        </div>
                                    </div>
                                </div>
                                <app-chart-pictorial [data]="audience?.women" name="omnichat-gender-woman"
                                    [uniqueDimensionConf]="{color: '#6794DC'}" category="name" iconType="woman"
                                    height="280px" [status]="audienceReqStatus[1].reqStatus">
                                </app-chart-pictorial>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- age -->
            <div class="col-12 col-md-6 mt-4">
                <div class="card height-fluid">
                    <div class="card-header">
                        <span class="h4">
                            {{ (selectedTab4 === 1 ? 'general.traffic' : 'general.conversions' ) | translate }}
                            {{ 'charts.byAge' | translate }}
                        </span>
                    </div>
                    <div class="card-body">
                        <app-chart-lollipop [data]="audience?.age" name="omnichat-age" category="age"
                            [value]="selectedTab4 === 1 ? 'visits' : 'sales'" height="280px"
                            [status]="audienceReqStatus[2].reqStatus">
                        </app-chart-lollipop>
                    </div>
                </div>
            </div>

            <!-- age and gender -->
            <div class="col-12 col-md-6 mt-4">
                <div class="card height-fluid">
                    <div class="card-header">
                        <span class="h4">
                            {{ (selectedTab4 === 1 ? 'general.traffic' : 'general.conversions' ) | translate }}
                            {{ 'charts.byGenderAndAge' | translate }}
                        </span>
                    </div>
                    <div class="card-body" style="height: 328px">
                        <!-- loader -->
                        <app-chart-loader *ngIf="chartsInitLoad && audienceReqStatus[3].reqStatus <= 1">
                        </app-chart-loader>

                        <!-- ready -->
                        <app-chart-pyramid *ngIf="audience?.genderAndAge?.length > 0" [data]="audience?.genderAndAge"
                            name="omnichat-age-and-gender" [status]="audienceReqStatus[3].reqStatus" height="280px">
                        </app-chart-pyramid>

                        <!-- empty data -->
                        <div *ngIf="audienceReqStatus[3].reqStatus === 2 && audience?.genderAndAge?.length === 0"
                            class="chart-error-container text-muted">
                            <p class="text-center">
                                {{ 'general.withoutData' | translate }} <br>
                                {{ 'general.withoutData2' | translate }}
                            </p>
                        </div>

                        <!-- error -->
                        <div *ngIf="chartsInitLoad && audienceReqStatus[3].reqStatus === 3"
                            class="chart-error-container text-muted">
                            <span> {{ 'general.errorData' | translate }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- weekday and hour -->
            <div class="col-12 col-lg-6 mt-4">
                <div class="card height-fluid">
                    <div class="card-header">
                        <span class="h4">
                            {{ (selectedTab4 === 1 ? 'general.traffic' : 'general.conversions' ) | translate }}
                            {{ 'charts.byDayAndHour' | translate }}
                        </span>
                    </div>
                    <div class="card-body">
                        <app-chart-heat-map [data]="audience?.weekdayAndHour" name="omnichat-weekday-sesions"
                            height="615px" [status]="audienceReqStatus[5].reqStatus" categoryX="weekdayName">
                        </app-chart-heat-map>
                    </div>
                </div>
            </div>

            <div class="col-12 col-lg-6 mt-4">
                <!-- weekday -->
                <div class="card">
                    <div class="card-header">
                        <span class="h4">
                            {{ (selectedTab4 === 1 ? 'general.traffic' : 'general.conversions' ) | translate }}
                            {{ 'charts.byWeekday' | translate }}
                        </span>
                    </div>
                    <div class="card-body">
                        <app-chart-bar-horizontal [data]="audience?.weekday" name="omnichat-traffic-day"
                            category='weekdayName' [status]="audienceReqStatus[4].reqStatus" value='value'
                            height="250px">
                        </app-chart-bar-horizontal>
                    </div>
                </div>

                <div class="card mt-4">
                    <!-- hour -->
                    <div class="card-header">
                        <span class="h4">
                            {{ (selectedTab4 === 1 ? 'general.traffic' : 'general.conversions' ) | translate }}
                            {{ 'charts.byHour' | translate }}
                        </span>
                    </div>
                    <div class="card-body">
                        <app-chart-lollipop [data]="audience?.hour" name="omnichat-traffic-hour" category="hour"
                            height="250px" [status]="audienceReqStatus[6].reqStatus">
                        </app-chart-lollipop>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>